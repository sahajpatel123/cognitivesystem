# Phase16 Step 7B Pentest / Self-Audit Checklist

## Headers & Transport
- Verify /api/chat responses include: X-Content-Type-Options, Referrer-Policy, X-Frame-Options, Permissions-Policy, Cache-Control.
- Verify HSTS present only when https and non-local environment.
- Confirm X-Request-Id is returned on all /api/chat responses.

## Cookies
- Check anon_session (or whoami) Set-Cookie has HttpOnly and SameSite=Lax.
- Secure flag present only when https and non-local.

## Abuse Throttle Scenarios
- Missing UA + Accept on /api/chat -> expect 429 with failure_type=RATE_LIMITED, Retry-After ~60.
- Missing UA + Accept + Content-Type on POST /api/chat plus limiter signal -> expect 403 with failure_type=ABUSE_BLOCKED, Retry-After ~600.
- Normal headers/auth -> allowed.

## Request Hygiene
- Unexpected methods on /api/chat accrue score but should return structured response if blocked.
- Non-HTTPS in non-local should elevate score; verify deterministic behavior.

## Logging & Privacy
- Ensure chat.summary contains only safe metadata; no user_text/rendered_text.
- Review logs for reasons (short, non-PII); verify no secrets/keys emitted.

## Key Rotation Drill (staging)
- Rotate MODEL_PROVIDER_API_KEY (or staging key) and redeploy; confirm requests still succeed.
- Rotate DATABASE_URL (if used) with maintenance window; confirm migrations not triggered here.
- Rotate JWT/secret keys if present; ensure login/anon still works and cookies reissued.

## Request ID Propagation
- Confirm X-Request-Id flows end-to-end in responses and logs.

## Observability Checks
- Ensure promotion_gate and security_gate scripts pass.
- Confirm pytest step7 headers/abuse tests pass locally.
