[phases.setup]
nixpkgsArchive = "5148520bfab61f99fd25fb9ff7bfbb50dad3c9db"
nixPkgs = ["python312", "python312Packages.virtualenv", "python312Packages.setuptools", "python312Packages.wheel", "nodejs_20"]

[phases.install]
cmds = [
  "set -eux",
  "command -v python3",
  "python3 --version",
  "command -v node",
  "node --version",
  "command -v npm",
  "npm --version",
  "rm -rf .venv",
  "virtualenv -p python3 .venv",
  ".venv/bin/python --version",
  ".venv/bin/python -m pip --version",
  ".venv/bin/python -m pip install --upgrade pip setuptools wheel",
  ".venv/bin/python -m pip install -r requirements.txt",
  "test -f frontend/package.json",
  "cd frontend && npm ci",
  "cd /app"
]

[phases.build]
cmds = [
  "set -eux",
  "cd frontend",
  "npm run build"
]

[start]
cmd = "bash start.sh"
